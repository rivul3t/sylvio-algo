#include "woody.h"

#include <stdio.h>
#include <stdlib.h>

char pload[] = "\x50\x51\x52\x56\x57\x41\x53\xe8\x1d\x00\x00\x00\xe8\x8b\x00\x00\x00\xe8\x59\x00\x00\x00\xe9\xa2\x00\x00\x00\x41\x5b\x5f\x5e\x5a\x59\x58\xe8\x30\x00\x00\x00\x50\xc3\xb8\x01\x00\x00\x00\xbf\x01\x00\x00\x00\x48\x8d\x35\xca\x00\x00\x00\xba\x0e\x00\x00\x00\x0f\x05\xc3\xe8\x0b\x00\x00\x00\x2d\x31\x31\x31\x31\x2d\x99\x99\x99\x99\xc3\x48\x8b\x04\x24\xc3\xe8\xf6\xff\xff\xff\x48\x2d\x71\x71\x71\x71\x48\x2d\x72\x72\x72\x72\x48\x05\x73\x73\x73\x73\xc3\xe8\xce\xff\xff\xff\xbe\x22\x22\x22\x22\xbf\x33\x33\x33\x33\x48\x01\xc7\xe8\xd1\xff\xff\xff\x48\x89\xc7\xb9\x44\x44\x44\x44\xba\x55\x55\x55\x55\xe8\xaa\xff\xff\xff\x48\x01\xc2\xc3\xba\x07\x00\x00\x00\xbe\x14\x14\x14\x14\xe8\xac\xff\xff\xff\x48\x89\xc7\x48\x81\xe7\x00\xf0\xff\xff\xb8\x0a\x00\x00\x00\x0f\x05\xc3\x41\xb9\x00\x00\x00\x00\x41\xbf\x10\x00\x00\x00\x4c\x8d\x15\x42\x00\x00\x00\x41\xb8\x00\x00\x00\x00\x49\x39\xf1\x0f\x84\x3c\xff\xff\xff\x48\x89\xf8\x45\x8a\x22\x44\x30\x20\x48\x83\xc7\x01\x49\x83\xc2\x01\x49\x83\xc1\x01\x49\x83\xc0\x01\x4d\x39\xf8\x74\xcc\x49\x39\xf1\x7e\xd4\x00\x00\x2e\x2e\x2e\x2e\x57\x4f\x4f\x44\x59\x2e\x2e\x2e\x2e\x0a\x48\x48\x48\x48\x48\x48\x48\x48\x48\x48\x48\x48\x48\x48\x48\x48\x10\x00";

int main(int argc, char *argv[]) {
    if (argc < 2) {
        printf("Usage: \n %s <filename>\n", argv[0]);
        exit(1);
    }
    char *file_to_infect = argv[1];
    info64 *info = malloc(sizeof(info64));
    info->parasite_size = sizeof(pload);
    info->parasite_code = (int8_t *)pload;

    infect(file_to_infect, info); 
}
